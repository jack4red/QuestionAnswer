{% load account_filter %}
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>微众云商通</title>
	<link rel="stylesheet" href="/static/css/introjs.css">
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <script src="/static/js/jquery-1.9.1.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/intro.js"></script>
	<style>
	html,body,ul,li{
		margin:0;
		padding:0;
		font-family:arial, "Microsoft YaHei";
	}
	ul li{
		list-style: none;
	}
	a:hover{
		text-decoration: none;
		outline: none;
	}
	a:focus{
		text-decoration: none;
		outline: none;
	}
	.xui-header{
		background: url('/static/images/top.png') no-repeat scroll right top #1183ca;
		height: 98px;
		width:100%;
		color:#fff;
	}
	.xui-header .main label{
		font-size: 22px;
		margin-left:65px;
		line-height: 66px
	}
	.main{
		width: 1000px;
		margin:0 auto;
		position: relative;
	}
	.sprite{
		top: 26px !important;
		background: url('/static/images/guideSprite.png');
	}
	.lock {
    	background: url("/static/images/top_change-pwd.png") no-repeat scroll 0 0 / 33% auto rgba(0, 0, 0, 0);
	}
	.top-help-center{
		background: url("/static/images/top_help_center.png") no-repeat scroll 0 0 / 35% auto rgba(0, 0, 0, 0);
	}
	.top-update{
		background: url("/static/images/top_update.png") no-repeat scroll 0 0 / 35% auto rgba(0, 0, 0, 0);
	}
	.fr{
		float: right;
		display: inline-block;
	}
	.fl{
		float: left;
		display: inline-block;
	}
	.superscript{
		background-color:#cf0401;
		color:#fff;
		position: absolute;
		width:16px;
		min-height: 13px;
		min-width: 16px;
		height:13px;
		text-align:center;
		top: 20px;
		left: 816px;
		border-radius: 2px;
		display: none;
	}
	.clearfix:after{
		content:".";
		display:block;
		height:0;
		clear:both;
		visibility:hidden;
	}
	.tx_submit{
		position: relative;
		margin-left: 40px;
		width: 65px;
		margin-right: 5px;
	}
	.xui-logo i{
		display: inline-block;
		width: 52px;
		height: 45px;
		background-position:-664px -144px;
		position: absolute;
		left: 5px;
		top:10px;
	}
	.xui-logo label{
		margin-top: 20px;
	}
	.xa-logout{
		position:relative;
		display: inline-block;
		width: 53px;
		height: 20px;
		background-position:-663px -118px;
		margin-left: 10px;
		vertical-align: middle;
		cursor: pointer;
	}
	.xa-edit{
		display: inline-block;
		width: 53px;
		height: 20px;
		margin-left: 10px;
		vertical-align: middle;
		
		
	}
	.xui-logout span{
		font-size: 13px;
		line-height: 66px;
	}
	.xui-item{
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-top: 60px;
		margin-bottom: 58px;
	}
	.xui-item li{
		text-align: center;
		width: 25%;
		float: left;
		cursor: pointer;
	}
	.xui-item li i{
		width: 166px;
		height: 190px;
		display:inline-block;
	}
	.xui-item li h3{
		font-size:21px;
		margin:32px auto 20px auto;
		color:#1f2229;
		font-weight: normal;
	}
	.xui-item li p{
		font-size:13px;
		color: #5f5f5f;
		line-height: 26px;
	}
	.xui-item li:nth-child(2) i{
		background-position:-166px 0;
	}
	.xui-item li:nth-child(3) i{
		background-position:-332px 0;
	}
	.xui-item li:last-child i{
		background-position:-498px 0;
	}
	.xui-system-telephone{
		float: left;
		height: 84px;
		padding-left: 62px;
		padding-right: 43px;
	}
	.xui-dedicated-telephone{
		float: left;
		width: 670px;
	}
	.xui-dedicated-telephone-m{
		float: left;
		padding-top: 22px;
		margin-right: 10px;
		font-size: 13px;
		color: #333;
		font-family: 宋体;
	}
	.xui-dedicated-telephone-n{
		padding-top: 16px;
		padding-bottom: 22px;

	}
	.xui-qrcode{
		float: right;
		margin-top: -117px;
	}
	.xui-footer{
		width: 1000px;
		margin: auto ;
	}
	.modifypassword{
		font-style: normal;
		display: block;
		margin-left: -16px;
		margin-top: 0px;
	}
	.fake-click{
		background: transparent;
		width: 60px;
		height: 47px;
		position: absolute;
		margin-top: 20px;
		margin-left: -236px;
		 top: 8px;
		cursor: pointer;
		font-size: 13px;
	}
	span input{
		width:151px;
		height:24px;
		border:1px solid #e5e5e5;
		margin-top: 10px;
	}
	.edit_password{
		display: none;
		color:red;
		margin-left: 60px;
		margin-top: 8px;
	}
	.popover-content {
		background:#f8f8f8;
		position:relative;
    	padding: 9px 24px;
    	width:267px;
    	min-height:172px;
    	color: #333;
    	border:#e5e5e5;
	}
	.btn-primary {
	  background: #207DBE;
	  border-color: #207DBE;
	}
	.btn-default {
	    background: #f8f8f8;
	    border-color: #e5e5e5;
	    text-shadow: 0 1px 0 #fff;
	    width: 65px;
	}
	.popover-content span{
		font-style: normal;
		line-height: 0px;
	}
	.controls {
	  font-style: normal;
	}
	.control-group{
		width:100%;
	}
{#    a.introjs-button:link{#}
{#        color:white;#}
{#        background-color: red;#}
{#    }#}
    a.introjs-button.introjs-skipbutton {
        color: #828282;
    }
    a.introjs-button.introjs-nextbutton.introjs-disabled{
        width: auto;
    }

	</style>
</head>
<body>
	<header class="xui-header">
		<div class="main clearfix">
			<div class="xui-logo fl">
				<i class="sprite xui-logo"></i>
				<label>微众云商通</label>
			</div>
			<div class="xui-logout fr" style="margin-top:16px">
				<span style="padding-right:12px;font-family: arial">你好！{{ user.username }}</span>
				<i class=" lock xa-edit" title="修改密码" style="margin-left: 22px;margin-top: -20px;">
					<span class="modifypassword" >修改密码</span>
				</i>
				<a href='message/help_center/'>
					<i class=" top-help-center xa-edit xa-help-center" title="帮助中心" style="margin-left: 22px;margin-top: -20px;">
						<div class="superscript xa-help"><i style="font-size:9px;display:block"></i></div>
						<span class="modifypassword" style="color:#fff">帮助中心</span>
					</i>
				</a>
                <a href='message/list_message/'>
                    <i class=" top-update xa-edit" title="更新列表" style="margin-left: 22px;margin-top: -20px;">
                        <div class="superscript xa-message" style="left: 896px;"><i style="font-size:9px;display:block"></i></div>
                        <span class="modifypassword" style="color:#fff">更新列表</span>
                    </i>
                </a>
				<i class="fake-click" data-toggle="popover" id="mf"></i>
				<i class="sprite xa-logout" title="退出" style="margin-top: -71px;">
					<span style="font-style: normal;">退出</span>
				</i>
				<div id='popover_tmpl' style="display:none;">
			 		<form class="form-horizontal">
						<div class="control-group">
							<span class="control-label" for="old_password">旧密码&nbsp;</span>&nbsp;&nbsp;
							<span class="controls">
								<input type="password" id="old_password" name="old_password"/>
							</span>
						</div>

						<div class="control-group">
							<span class="control-label" for="new_password">新密码&nbsp;</span>&nbsp;&nbsp;
							<span class="controls">
								<input type="password" id="new_password" name="new_password" />
							</span>
						</div>

						<div class="control-group">
							<span class="control-label" for="confirm_password">确认密码</span>
							<span class="controls">
								<input type="password" id="confirm_password" name="confirm_password"/>
								<p class="origin edit_password" error="old_password" style="margin-top: 18px;"></p>
							</span>
						</div>

						<div class="control-group" style="line-height:0px; margin-top:7px;margin-bottom:7px;">
							<label class="control-label" for="confirm_password"></label><br/>
							<div class="controls">
								&nbsp;&nbsp;&nbsp;&nbsp;<input type="button" class="btn btn-primary tx_submit btn-sm " value="&nbsp;&nbsp;&nbsp;&nbsp;保存&nbsp;&nbsp;&nbsp;&nbsp;" />&nbsp;&nbsp;&nbsp;
								<input type="button" class="btn btn-default tx_cancle btn-sm" value="&nbsp;&nbsp;&nbsp;&nbsp;取消&nbsp;&nbsp;&nbsp;&nbsp;" />
							</div>
						</div>
					</form>
	 			</div>
			</div>
		</div>
	</header>

	<section class="main">
		{% with user|get_unified_auth_token as unified_auth_token %}
		<ul class="xui-item">
            {% if user.get_profile.version_read %}
                <li>
                    {% if user_module.big_data %}
                        <a target="_blank" href="http://data.weizoom.com/?token={{unified_auth_token}}" class="title_blank"><img src="/static/images/shuju.png" alt="数据挖掘"></a>
                    {% else %}
                        <a><img src="/static/images/shuju-power.png" alt="数据挖掘"></a>
                    {% endif %}
                </li>
                <li>
                    {% if user_module.fans %}
                        <a target="_blank" href="http://weibo.weizoom.com/?token={{unified_auth_token}}"><img src="/static/images/fensi.png " alt="粉丝沟通"></a>
                    {% else %}
                        <a><img src="/static/images/fensi-power.png " alt="粉丝沟通"></a>
                    {% endif %}
                </li>
                <li>
                    {% if user_module.weapp %}
                        <a target="_blank" href="http://weapp.weizoom.com/mall/outline/get/?token={{unified_auth_token}}" class="mall" ><img src="/static/images/mall.png" alt="微商场"></a>
                    {% else %}
                        <a><img src="/static/images/mall-power.png" alt="微商场"></a>
                    {% endif %}
                </li>
                <li>
                    {% if user_module.compass %}
                        <a><img src="/static/images/shujufenxi.png" alt="数据罗盘" ></a>
                    {% else %}
                        <a><img src="/static/images/shujufenxi-power.png" alt="数据罗盘" ></a>
                    {% endif %}
                </li>
            {% else %}
                <li>
                    <a><img src="/static/images/shuju.png" alt="数据挖掘"></a>
                </li>
                <li>
                    <a><img src="/static/images/fensi.png " alt="粉丝沟通" ></a>
                </li>
                <div data-intro="<p class='title'>微信云商通:升级啦！</p><p class='text'>我们增加了很多新功能,欢迎体验新版!</p>" data-step="1" data-tooltipClass="color: red;"></div>
                <li>
                    <a><img src="/static/images/mall.png" alt="微商城" data-intro="<p class='title'>微商城:</p><p class='text'>微信与微商城完美结合，快速开店，与粉丝零距离互动。</p>" data-step="2" data-position="left" data-tooltipClass="color: red;"></a>
                </li>
                <li>
                    <a><img src="/static/images/shujufenxi.png" alt=" 数据罗盘" data-intro="<p class='title'>数据罗盘:</p><p class='text'>提供实时运营数据统计，大幅提升运营效率和收益。</p>" data-step="3" data-position="left" data-tooltipClass="color: green;"></a>
                </li>
            {% endif %}
		</ul>
		{% endwith %}
	</section>
	<footer class="xui-footer">
		<div style="background-color: #F4F4F4; hight: 84px; overflow:hidden;">
			<div class="xui-system-telephone" style="margin-top: 16px;">
				<img src="/static/images/footer.png" alt="电话联系负责人">
			</div>
			<div class="xui-dedicated-telephone">
				<div class="xui-dedicated-telephone-m">
					<div>数据挖掘&粉丝互动</div>
					<div class="xui-dedicated-telephone-n">店铺装修&百宝箱</div>
				</div>
				<div class="xui-dedicated-telephone-m" style="color:#cf0404">
					<div>由冬冬：15210951485</div>
					<div class="xui-dedicated-telephone-n">刘楠：13911481487</div>
				</div>
				<div class="xui-dedicated-telephone-m" style="margin-left:55px;">
					<div>微信互动</div>
					<div class="xui-dedicated-telephone-n">微商城</div>
				</div>
				<div class="xui-dedicated-telephone-m" style="color:#cf0404">
					<div>李双双：15637607750</div>
					<div class="xui-dedicated-telephone-n">李楠：18610793626</div>
				</div>
				<div style="float:right">
					<div style="padding-top: 22px;">系统服务微信号：</div>
				</div>
			</div>
		</div>
		<div class="xui-qrcode">
			<img src="/static/images/2weima.png" alt="二维码">
		</div>
		<div style="clear:both;text-align: center;line-height: 57px;font-size: 13px;color: #7d7d7d;font-family: 宋体;">
			<p>Copyright © 2012-2015 微众传媒 All Rights Reserved.</p>
		</div>		
	</footer>
	<script type="text/javascript">
		$(document).ready(function() {
            //引导页
            var read_tag = '{{ user.get_profile.version_read|safe }}';
            if(read_tag == 'False' ){
                IntroJS('{{ user.id|safe }}');
            }

            update_superscript('xa-help {{ help_counts }}');
			update_superscript('xa-message {{ message_counts }}');
			function update_superscript(cls){
				var args_array = cls.split(' ');
				var className = args_array[0];
				var unread_counts = args_array[1];
				var $el = $('.'+className+'>i');
				if(unread_counts == 0){
					$el.parent().hide();
				}else{
					$el.text(unread_counts).parent().show();
				}
			}
			$('.xa-logout').click(function(event) {
				window.location.href = '/logout/'
			});
			// $('.title_blank').mouseover().css("text-decoration:none");
			var tmpl = getPopoverContent();
			$('#mf').popover({
			    'html': true,
			    'trigger': "click",
			    'content': tmpl,
			    'container': '.xui-logout',
			    'animation': false,
			    'placement': "bottom",
			    'template': '<div class="popover" role="tooltip" id="popover"><div class="arrow"></div><div class="popover-content"></div></div>'
	  		});
	  		$('#mf').on('shown.bs.popover',initSubmit);
	  		$('.fake-click').mouseover().attr("title","修改密码");

	  	});
	  		
			
		function getPopoverContent(){
			var result = $('#popover_tmpl').html();
			$('#popover_tmpl').remove();
			return result;
		}

		function initSubmit(){
			$('#old_password').val('');
			$('.tx_cancle').on('click',function(){
				$('#mf').popover('hide');
			});
			$('.tx_submit').on('click',function(){
	  			var oldPassword = $('#old_password').val();
				var newPassword = $('#new_password').val();
				var confirmPassword = $('#confirm_password').val();
			
				if (oldPassword.length == 0) {
					$('.edit_password').text("请输入初始密码").css('display', 'block');
					return false;
				}
				if (newPassword.length == 0) {
					$('.edit_password').text("请输入新密码").css('display', 'block');
					return false;
				}
				if (confirmPassword.length == 0) {
					$('.edit_password').text("请输入确认密码").css('display', 'block');
					return false;
				}
				if (newPassword != confirmPassword && confirmPassword !=0) {
					$('.edit_password').text("两次密码输入不一致").css('display', 'block');
					return false;
				}

				$.post('/password/update/', {
					old_password: oldPassword,
					new_password: newPassword,
					confirm_password: confirmPassword
				}, function(response) {
					if (response.code == 200) {
						if (response.data.success) {
							$('.edit_password').text("").css('display', 'block');
							alert("修改成功");
							window.location.href = "/logout"; 
						} else {
							alert(response.data.reason);
						}
						$('#old_password').val('');
						$('#new_password').val('');
						$('#confirm_password').val('');
					}
					else{
						$('.edit_password').text("初始密码不正确").css('display', 'block');	
					}
				});
				return false;
			});

			$('input').blur(function(event) {
				var div = $('div.control-group');
				// div.removeClass('error');
				// div.find('.help-inline').hide();
			});
		}
        //引导页
        function IntroJS(user_id){
            introJs().setOptions(
                    {
                        'showStepNumbers':'false',
                        'keyboardNavigation':'false',
                        'showBullets':'false',
                        'exitOnOverlayClick':'false',
                        'exitOnEsc':'false'
                    }).oncomplete(function(){
                         $.ajax({
                            url:'/account/version_read/?id='+user_id,
                            type:'get',
                            success:function(resp){
                                if(resp.code=='200'){
                                    location.reload();
                                }
                            },
                            error:function(error){
                                console.log(error);
                            }
                         });
                    }).start();
        }
	</script>
</body>
</html>
